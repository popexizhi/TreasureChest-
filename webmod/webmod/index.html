<!DOCTYPE html>
<html>
<title>cluter</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://192.168.1.207/lib/w3.css">
<link rel="stylesheet" href="http://192.168.1.207/lib/w3-theme-teal.css">
<link rel="stylesheet" href="http://192.168.1.207/lib/font-awesome.min.css"><style>
body {font-family: "Roboto", sans-serif}
.w3-bar-block .w3-bar-item{padding:16px;font-weight:bold}
</style>
<body>

<nav class="w3-sidebar w3-bar-block w3-collapse w3-animate-left w3-card-2" style="z-index:3;width:360px;" id="mySidebar">
  <div ><img src="http://192.168.1.207/lib/ico.jpg" style="width:25%;"></div>
    <a class="w3-bar-item w3-button w3-hide-large w3-large" href="javascript:void(0)" onclick="w3_close()">Close <i class="fa fa-remove"></i></a>
      <div id="index_list"></div>

</nav>
<script>
var list=[
    @cluster_list_arr
    ];
var res="";
for (var i=0; i<list.length; i++) 
    {
        res = res + "<a class='w3-bar-item w3-button' href='javascript:void(0)' onclick='open_data(\"" + list[i] + "\")'>" + list[i] + "</a>";
    }
document.getElementById("index_list").innerHTML = res;
</script>
    <div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" id="myOverlay"></div>
   
    <div class="w3-main" style="margin-left:350px;" name="showframe">
    
    <div id="myTop" class="w3-container w3-top w3-theme w3-large">
    <p><i class="fa fa-bars w3-button w3-teal w3-hide-large w3-xlarge" onclick="w3_open()"></i>
    <span id="myIntro" class="w3-hide">cluter 测试报告</span></p>
    </div>
    
    <header class="w3-container w3-theme" style="padding:64px 32px">
    <h1 class="w3-xxxlarge">cluter 测试结果</h1>
    </header>

    <div class="w3-container" style="padding:32px">
    
    <h2>结果概述</h2>
    
    <p>pass err </p>
    
    <ul class="w3-leftbar w3-theme-border" style="list-style:none">
    <li>详细测试结果列表:</li>
     <a class="w3-bar-item w3-button" onclick="myAccordion('testsuit_list')" href="javascript:void(0)">list:<i class="fa fa-caret-down"></i></a>
      <div>
          <div id="testsuit_list" class="w3-show">
                    <a class="w3-bar-item w3-button w3-teal" href="#fgw">fgw集群测试结果</a>
                    <a class="w3-bar-item w3-button w3-teal" href="#bgw">bgw集群测试结果</a>
                    <a class="w3-bar-item w3-button w3-teal" href="#nag">nag集群测试结果</a>
          </div>
      </div>
    </ul>
    <br>
    
    <div id="all_test"></div>

    </p>
    
    </div>
    
    <hr>
    <h2>详细测试报告结果</h2>
    <div id="report_data"> </div> 
    </div>
    
    <footer class="w3-container w3-theme" style="padding:32px">
    <p>Footer information goes here</p>
    </footer>
    
    </div>
    
    <script>
    init_all_test(); //加载testcase说明
    //打开对应的测试报告数据
    function open_data(report_name){
        var http = new XMLHttpRequest();
        var url = "http://192.168.1.207:8999/cluter_test/"+ report_name;
        var params = "test";
        var data;
        http.open("POST", url, true);
        var title_name= "<a href=http://192.168.1.216/test/provision_test/load_test/cluster/" +report_name +" target='_blank'>" + url + "</a>";
        document.getElementById("myIntro").innerHTML = title_name ;
        //Send the proper header information along with the request
        http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

        http.onreadystatechange = function() {//Call a function when the state changes.
        if(http.readyState == 4 && http.status == 200) {
                data = http.responseText;
                //console.log(data);
                //document.getElementById("report_data").innerHTML=data;
                data_json = JSON.parse(data);
                res_get(data_json);
           }
        }
        http.send(params);
        //myAccordion('demo');
    }
    //生成对应的测试用例集说明
    function init_all_test(){
       var testsuits=["fgw","bgw","nag"]; 
       var testcases=[
            ["cluster_normal_online","fgw_restart_quickly","fgw_shutdown","fgw_start_up"],
            ["cluster_normal_online","bgw_restart_quickly","bgw_shutdown","bgw_start_up"],
            ["cluster_normal_online","nag_restart_quickly","nag_shutdown","nag_start_up"]
       ];
       var testcases_doc= new Array(); 
       //用例描述,业务模型,结果检查条件[测试结果说明]
       testcases_doc["cluster_normal_online"]=["根据已连接的ue数量进行均匀分配","nag/fgw/bgw 分别2个，启动100个ue进行连接并做业务活动","nag ---> per ue: 32kbps","nag1,nag2/fgw1,fgw2/bgw1,bgw2接入量均>=48"]; 
       testcases_doc["fgw_restart_quickly"]=["快速重启","集群中2个fgw在线并各自接入了50左右ue做业务活动，快速重启fgw1","nag ---> per ue: 32kbps","原有ue在fgw1重启后再次成功接入并恢复业务活动"]; 
       testcases_doc["fgw_shutdown"]=["集群中一个结点下线","集群中2个fgw在线并各自接入了50左右ue做业务活动，kill掉fgw1","nag ---> per ue: 32kbps","原有fgw1上的ue连接在fgw1下线后连接到fgw2并恢复业务活动"]; 
       testcases_doc["fgw_start_up"]=["集群中新增一个结点","集群中fgw1在线并接入了100ue做业务活动，启动fgw2","nag ---> per ue: 32kbps","fgw1上连接的ue数量不变，fgw2上没有ue接入"]; 
       testcases_doc["bgw_restart_quickly"]=["快速重启","集群中2个bgw在线并各自接入了1个nag做业务活动，快速重启bgw1","nag ---> per ue: 32kbps","原有在bgw1上的nag在bgw1重启后再次成功接入并恢复业务活动"]; 
       testcases_doc["bgw_shutdown"]=["集群中一个结点下线","结点下线集群中2个bgw在线并各自接入了1个nag做业务活动，kill掉bgw1","nag ---> per ue: 32kbps","原有bgw1上的nag在bgw1下线后连接到bgw2并恢复业务活动"]; 
       testcases_doc["bgw_start_up"]=["集群中新增一个结点","集群中bgw1在线并接入了2个nag做业务活动，启动bgw2","nag ---> per ue: 32kbps","bgw1上连接的nag数量不变，bgw2上没有nag接入"]; 
       
       testcases_doc["nag_restart_quickly"]=["快速重启","集群中2个nag在线并各自接入了50左右ue做业务活动，快速重启nag1","nag ---> per ue: 32kbps","原有在nag1上的ue在nag1重启后再次成功接入并恢复业务活动"]; 
       testcases_doc["nag_shutdown"]=["集群中一个结点下线","集群中2个nag在线并各自接入了50左右ue做业务活动，kill掉nag1","nag ---> per ue: 32kbps","原有nag1上的ue连接在nag1下线后连接到nag2并恢复业务活动"]; 
       testcases_doc["nag_start_up"]=["集群中新增一个结点","集群中nag1在线并接入了100ue做业务活动，启动nag2","nag ---> per ue: 32kbps","nag1上连接的ue数量不变，nag2上没有ue接入"]; 
       
       var out="";
       var ts_out="";
       var tc_out="";
       console.log("testsuits.length:" + testsuits.length);
       for(var ts = 0; ts < testsuits.length; ts++){
            ts_out = '<h2 id="' + testsuits[ts] + '">' + testsuits[ts] +'集群</h2>';
            ts_out = ts_out + '<div class="w3-container w3-sand w3-leftbar">';

            for(var tc =0; tc < testcases[ts].length; tc++ ){
                console.log("[for]tc:" + tc +","+ testcases[ts][tc]);
                tc_out = '<h3> 测试用例名称:' + testcases[ts][tc] + '</h3>';
                tc = tc + 1;
                tc_out = tc_out + '<p><i>连接分配规则：'+ testcases_doc[testcases[ts][tc-1]][0] +'<br>' ;
                tc_out = tc_out + '用例描述:<'+ testcases_doc[testcases[ts][tc-1]][1] +'br>' ;
                tc_out = tc_out + '业务模型:'+ testcases_doc[testcases[ts][tc-1]][2] +'<br>' ;
                tc_out = tc_out + '结果检查条件:'+ testcases_doc[testcases[ts][tc-1]][3] +'</i><br></p>' ;
                
                tc_out = tc_out + '<h3>测试结果:</h3>' ;
                tc_out = tc_out + '<p><i><div id="var_' + testsuits[ts] + '_c' + tc + '_result"></div><br>' ;
                tc_out = tc_out + '<p><i>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_total_ue_num"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_check_ue_num"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_half_ue_num"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_plan_restore_ue_num"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_real_restore_ue_num"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_restore_avg_time"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_restore_max_time"></div>' ;
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_restore_min_time"></div>' ;
                tc_out = tc_out + '</i>详细测试结果<br>'
                tc_out = tc_out + '<div id="var_' + testsuits[ts] + '_c' + tc + '_html"></div><br></p>' ;
                console.log("tc_out:" + tc_out);
                ts_out = ts_out + tc_out;
                tc = tc - 1;
            }
            out = out + ts_out + '</div>'; 
            console.log("ts_out:" + ts_out);
       }
       
       console.log("hi, init_all_test");
       console.log(out);
       document.getElementById("all_test").innerHTML = out ;
    }

    //json get  report
    function res_get(arr){
        var out = "";
        var i;
        for(i = 0; i < arr.length; i++) {
            //console.log(arr[i].key);
            //console.log(out);
            try {

                out = arr[i].key + ": " + arr[i].value;
                //_result 中 #处理
                if (arr[i].key.search(/_result$/) > -1 ){
                    arr[i].value = arr[i].value.replace(/#/g, " ");
                    //console.log("replac:"+arr[i].value );
                    if (arr[i].value.search(/Fail/) > -1){
                        //pass
                        out = '<font size="5" face="verdana" color="red">' + arr[i].value +'</font>'
                    } else{
                        //fail
                        out = '<font size="6" face="verdana" color="green">' + arr[i].value +'</font>'
                    }
                }
                //_html 处理
                if (arr[i].key.search(/_html$/) == -1 ){
                    console.log("no _html:"+arr[i].key);
                    //console.log(arr[i].key.search(/_html/));
                    //out = arr[i].key + ": " + arr[i].value;
                }else{
                    out = arr[i].key + ": <a target='_black' href='" + arr[i].value + "'>" + arr[i].value + "</a>";
                    //console.log("has -- _html:"+arr[i].key);
                    //console.log(arr[i].key.search(/_html/));
                }
                document.getElementById(arr[i].key).innerHTML = out ;

            } catch (e) {
                  console.log(e instanceof TypeError); // true
//                  console.log(e.message);              // "null has no properties"
//                  console.log(e.name);                 // "TypeError"
//                  console.log(e.fileName);             // "Scratchpad/1"
//                  console.log(e.lineNumber);           // 2
//                  console.log(e.columnNumber);         // 2
//                  console.log(e.stack);                // "@Scratchpad/2:2:3\n"
            }
        } 
    }


    // Open and close the sidebar on medium and small screens
    function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
    }
    function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
    }
    
    // Change style of top container on scroll
    window.onscroll = function() {myFunction()};
    function myFunction() {
    if (document.body.scrollTop > 80 || document.documentElement.scrollTop > 80) {
    document.getElementById("myTop").classList.add("w3-card-4", "w3-animate-opacity");
    document.getElementById("myIntro").classList.add("w3-show-inline-block");
    } else {
    document.getElementById("myIntro").classList.remove("w3-show-inline-block");
    document.getElementById("myTop").classList.remove("w3-card-4", "w3-animate-opacity");
    }
    }
    
    // Accordions
    function myAccordion(id) {
        var x = document.getElementById(id);
        if (x.className.indexOf("w3-show") == -1) {
            x.className += " w3-show";
            x.previousElementSibling.className += " w3-theme";
        } else { 
            x.className = x.className.replace("w3-show", "");
            x.previousElementSibling.className = 
            x.previousElementSibling.className.replace(" w3-theme", "");
        }
    }
    </script>
    
  </body>
</html> 
